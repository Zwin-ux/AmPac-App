# AmPac OS: Ecosystem Specification

## Vision
**AmPac OS** is a unified operating system for community lending. It bridges the gap between high-touch relationship banking and modern digital efficiency. It consists of three distinct but deeply integrated products that share a single "brain" and data layer.

---

## 1. The Ecosystem Architecture

### A. The Borrower App (`apps/mobile`)
*   **User**: Entrepreneurs / Small Business Owners.
*   **Goal**: "Capital at the speed of thought."
*   **Key Features**:
    *   **Unified Application**: One profile for all loan products.
    *   **Real-time Status**: "Domino's Pizza Tracker" for loans (Applied -> Underwriting -> Approved -> Funded).
    *   **Document Wallet**: Snap photos of tax returns/licenses once, use forever.
    *   **Direct Line**: Chat with assigned loan officers (synced to Staff Console).
    *   **Resource Hub**: Book conference rooms, access business coaching.

### B. The Staff Console (`apps/console`)
*   **User**: Loan Officers, Underwriters, Admins.
*   **Goal**: "The Microsoft 365-powered Command Center."
*   **Key Features**:
    *   **SSO & Identity**: Powered by Azure Active Directory (Entra ID).
    *   **Workboard**: Kanban-style view of the pipeline (synced with Ventures).
    *   **360Â° Borrower View**: See everything the borrower sees + internal notes/risk flags.
    *   **Productivity Integration**:
        *   *Calendar*: See availability and schedule closing meetings directly.
        *   *Email*: Outlook integration for correspondence tracking.
        *   *Files*: SharePoint/OneDrive integration for document storage.

### C. The Brain (`apps/brain`)
*   **User**: System (Autonomous Agents).
*   **Goal**: "The invisible glue that makes it all work."
*   **Key Features**:
    *   **Sync Engine**: Bi-directional sync between modern Firestore (App data) and legacy Ventures (LOS data).
    *   **AI Agents**:
        *   *Underwriting Assistant*: Pre-analyzes uploaded documents (OCR + LLM).
        *   *Scheduler Agent*: Finds mutual availability between Staff (Outlook) and Borrower.
    *   **Notification Router**: Decides if an event needs a Push Notification (Mobile), Email (Outlook), or Slack alert.

---

## 2. End-to-End Workflows (The "Golden Paths")

### Workflow 1: The "Magic" Application
1.  **Mobile**: Borrower signs up, completes profile, and hits "Apply".
2.  **Brain**:
    *   Detects new application in Firestore.
    *   Creates a corresponding record in **Ventures** (via Mock/Real API).
    *   Creates a **SharePoint** folder for the borrower.
    *   Sends a "New Deal" alert to the **Console**.
3.  **Console**: Staff sees the new deal in the "Inbox" column.
    *   Staff clicks "Review".
    *   Staff sees the AI summary generated by **Brain**.

### Workflow 2: The "Frictionless" Document Chase
1.  **Console**: Underwriter marks a condition: "Need 2024 Tax Returns".
2.  **Brain**:
    *   Syncs this condition to Firestore.
    *   Triggers a Push Notification to **Mobile**: "Action Required: Upload 2024 Taxes".
3.  **Mobile**: Borrower taps notification, opens camera, scans document.
4.  **Brain**:
    *   Receives file.
    *   Uploads to **SharePoint/Ventures**.
    *   Marks condition as "Received" in **Ventures**.
    *   Notifies Staff in **Console**.

### Workflow 3: The "One-Click" Closing Meeting
1.  **Console**: Loan approved. Staff clicks "Schedule Closing".
2.  **Brain**:
    *   Queries **Microsoft Graph** for Staff's calendar availability.
    *   Generates 3 slot options.
3.  **Mobile**: Borrower sees "Select Closing Time" card with the 3 slots.
4.  **Mobile**: Borrower picks Tuesday @ 2 PM.
5.  **Brain**:
    *   Books the meeting in Staff's **Outlook Calendar**.
    *   Sends calendar invite to Borrower.
    *   Updates Loan Status to "Closing Scheduled".

---

## 3. Technical Stack & Integration Points

| Component | Auth Provider | Database Access | Key Integrations |
| :--- | :--- | :--- | :--- |
| **Mobile** | Firebase Auth (Phone/Email) | Firestore (Client SDK) | Expo, Camera, Push Notifications |
| **Console** | Microsoft Entra ID (SSO) | Firestore (Client SDK) | MSAL (Graph API), Ventures (via Brain) |
| **Brain** | Service Account | Firestore (Admin SDK) | Ventures API, MS Graph API, OpenAI |

### Data Source of Truth
*   **User Profile**: Firestore (Mobile owns this).
*   **Loan Status/Terms**: Ventures (Brain syncs this to Firestore for read-only display).
*   **Documents**: SharePoint/ShareFile (Brain manages the upload/link).
*   **Calendar**: Microsoft Exchange (Graph API).

---

## 4. Implementation Roadmap

### Phase 1: Foundation (Current Status)
- [x] Mobile App scaffolding.
- [x] Console App scaffolding with MSAL SSO.
- [x] Brain Service with basic Sync structure.
- [x] Firestore Database setup.

### Phase 2: The "Sync" Core (Next Steps)
- [ ] **Brain**: Implement robust `SyncService` to mirror Ventures Loan Status -> Firestore.
- [ ] **Console**: Build the "Workboard" to visualize Firestore data.
- [ ] **Mobile**: Ensure `ApplicationScreen` reflects these status changes in real-time.

### Phase 3: Microsoft Integration
- [ ] **Brain**: Implement `GraphClient` to fetch Staff availability.
- [ ] **Console**: Add "My Calendar" widget using Graph API.
- [ ] **Mobile**: Add "Book Appointment" flow.

### Phase 4: AI Intelligence
- [ ] **Brain**: Add `DocumentAgent` to classify uploaded files.
- [ ] **Console**: Display AI insights on the Application Detail page.
